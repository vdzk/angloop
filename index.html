<html>
  <head>
    <title>
      Angloop!
    </title>
    <style>
      svg {
        padding: 3px;
      }
    </style>
  </head>
  <body>
    <div id="svgs"></div>
    <script>
      let size = 128
      function draw({loops, sides, commands}) {
        const turn = (loops * Math.PI * 2) / sides  //In radians
        let angle = turn
        let lastPoint = {x: 0, y: 0}
        const points = [{x: 0, y: 0}]
        for (let s = 0; s < sides; s++) {
          [...commands].forEach(c => {
            if (c === 'F') {
              const {x, y} = lastPoint
              const dx = Math.cos(angle)
              const dy = Math.sin(angle)
              const nextPoint = {
                x: x + dx,
                y: y + dy,
              }
              points.push(nextPoint)
              lastPoint = nextPoint
            } else if (c === 'R') {
              angle += turn
            } else if (c === 'L') {
              angle -= turn
            }
          })
        }
        let minX = 0
        let minY = 0
        let maxX = 0
        let maxY = 0
        points.forEach(point => {
          const {x, y} = point
          minX = Math.min(minX, x)
          minY = Math.min(minY, y)
          maxX = Math.max(maxX, x)
          maxY = Math.max(maxY, y)
        })
        const length = maxX - minX
        const height = maxY - minY
        const scale = size / Math.max(length, height)
        points.forEach(point => {
          const {x, y} = point
          point.x = (x - minX) * scale + 1
          point.y = (y - minY) * scale + 1
        })
        const svgEl = document.createElementNS("http://www.w3.org/2000/svg", "svg")
        svgEl.setAttribute('width', size+2+'px')
        svgEl.setAttribute('height', size+2+'px')
        for (let i = 0; i < points.length - 1; i++) {
          const lineEl = document.createElementNS('http://www.w3.org/2000/svg','line');
          lineEl.setAttribute('x1', points[i].x);
          lineEl.setAttribute('y1', points[i].y);
          lineEl.setAttribute('x2', points[i+1].x);
          lineEl.setAttribute('y2', points[i+1].y);
          lineEl.setAttribute("stroke", "black")
          svgEl.append(lineEl);
        }
        document.getElementById('svgs').append(svgEl)
        // document.getElementById('svgs').append(document.createTextNode(commands))
      }

      function simplify(commands) {
        let simplified = true
        while (simplified) {
          simplified = false
          if ((commands[0] === 'L' && commands[commands.length - 1] === 'R') || (commands[0] === 'R' && commands[commands.length - 1] === 'L')) {
            commands = commands.slice(1, -1)
            simplified = true
          }

          let newCommands = commands.replace('RL', '')
          newCommands = newCommands.replace('LR', '')

          if (newCommands.length < commands) {
            simplified = true
          }
        }

        return commands
      }

      const angles = {}
      function interesting({loops, sides, commands}) {
        const angle  = sides / loops
        if (angle === 2 || angle === 1 || angle < 1) {
          return false
        }
        angles[angle] = angles[angle] || []
        if (angles[angle].includes(commands)) {
          return false
        } else {
          angles[angle].push(commands)
          return true
        }
      }

      const moves = ['F', 'R', 'L']
      function recMove(config, commandsSupply) {
        if (commandsSupply === 0) {
          config.commands = simplify(config.commands)
          if (interesting(config)) {
            draw(config)
          }
        } else {
          for (const move of moves) {
            recMove({...config, commands: config.commands + move}, commandsSupply - 1)
          }
        }
      }

      const maxSupply = 10
      for (let supply = 9; supply < maxSupply; supply++) {
        for (let s = 0; s <= supply; s++) {
          const angleSupply = s
          const commandsSupply = supply - s
          for (let as = 0; as <= angleSupply; as++) {
            const loopsSupply = as
            const sidesSupply = angleSupply - as
            const newConfig = {
              loops: 1 + loopsSupply,
              sides: 3 + sidesSupply,
              commands: 'RF'
            }
            recMove(newConfig, commandsSupply)
          }
        }
      }
    </script>
  </body>
</html>
